# ⚡ Grid Demand Insights - 電力需給分析アプリケーション

日本の電力需給実績データを分析・可視化するためのデスクトップアプリケーションです。2つの実装を提供しています。

## 📱 アプリケーション概要

### 🖥️ JavaFX版 (`jukyu_app_javafx`)
軽量で高速な基本的なデータビューアです。
- **対象ユーザー**: データの概要確認、簡易的な可視化が必要な方
- **主な機能**: データ可用性ヒートマップ、テーブルプレビュー、基本的な折れ線グラフ
- **動作要件**: JDK 17以降、メモリ4GB

### 🐍 Python版 (`jukyu_app_python_desktop`) ⭐ 推奨
高度な統計分析とAI予測機能を搭載した本格的な分析ツールです。
- **対象ユーザー**: データアナリスト、研究者、電力事業関係者
- **主な機能**: 
  - 📊 多系列グラフ表示（ズーム・パン対応）
  - 📈 統計分析（相関分析、分布分析、時間帯別パターン）
  - 🤖 AI予測（ARIMA、Transformer、指数平滑法、STL分解）
  - 🌤️ 気象データ統合（気象庁データとの相関分析、ARIMAX予測）
  - 📉 発電種別比較（エリア間・時系列比較）
  - 🔢 数値比較分析（異なる年月・エリアの定量比較）
- **動作要件**: Python 3.10-3.12、メモリ8GB以上（AI機能使用時は16GB推奨）

## 📁 ディレクトリ構造

```
demand_analy/
├── README.md                          # このファイル
├── FEATURES.md                        # 機能詳細ドキュメント
├── DEVELOPMENT_HISTORY.md             # 開発履歴
├── jukyu_app_javafx/                  # JavaFX版アプリ
│   ├── build.gradle                   # ビルド設定
│   ├── src/main/java/                 # Javaソースコード
│   └── data/                          # データファイル配置先
└── jukyu_app_python_desktop/          # Python版アプリ（推奨）
    ├── main.py                        # メインプログラム
    ├── requirements.txt               # 依存パッケージ一覧
    ├── data/                          # 電力需給データ配置先
    │   ├── eria_jukyu_202504_01.csv   # 2025年4月 北海道データ
    │   ├── eria_jukyu_202505_01.csv   # 2025年5月 北海道データ
    │   └── weather/                   # 気象データ配置先（オプション）
    │       ├── sapporo_20250401_20250430.csv
    │       └── tokyo_20250401_20250430.csv
    └── ml/                            # 機械学習モデル（Transformer用）
```

## 📊 データ要件

### 電力需給データ

両アプリケーションは、`data/`ディレクトリに配置された月次CSVファイルを読み込みます。

#### ファイル命名規則
```
eria_jukyu_YYYYMM_AA.csv
```

- **YYYYMM**: 年月（例: `202504` = 2025年4月）
- **AA**: エリアコード（01～10の2桁）

#### エリアコード対応表
| コード | 電力会社 | 気象観測地点 |
|--------|----------|------------|
| 01 | 北海道電力 | 札幌 (sapporo) |
| 02 | 東北電力 | 仙台 (sendai) |
| 03 | 東京電力 | 東京 (tokyo) |
| 04 | 中部電力 | 名古屋 (nagoya) |
| 05 | 北陸電力 | 金沢 (kanazawa) |
| 06 | 関西電力 | 大阪 (osaka) |
| 07 | 中国電力 | 広島 (hiroshima) |
| 08 | 四国電力 | 高松 (takamatsu) |
| 09 | 九州電力 | 福岡 (fukuoka) |
| 10 | 沖縄電力 | 那覇 (naha) |

#### データフォーマット
- **エンコーディング**: Shift_JIS / CP932（UTF-8も対応）
- **時間間隔**: 30分間隔（00:00, 00:30, 01:00, ...）
- **単位**: MW平均（瞬時電力）
- **ヘッダー**: 
  - 1行目: `単位[MW平均]`（自動でスキップされます）
  - 2行目: 列名（DATE, TIME, エリア需要, 原子力, 火力(LNG), ...）

#### 必須列
- `DATE`: 日付（YYYY/MM/DD形式）
- `TIME`: 時刻（HH:MM形式）
- `エリア需要`: エリア全体の電力需要
- 各発電種別の出力（原子力、火力、水力、太陽光、風力など）

### 気象データ（オプション）

気象庁の時別値データを使用することで、天候と電力需給の関係を分析できます。

#### 配置場所
```
jukyu_app_python_desktop/data/weather/
```

#### ファイル命名規則
```
{都市名}_{開始日YYYYMMDD}_{終了日YYYYMMDD}.csv
または
{都市名}_{年月YYYYMM}.csv
```

**例:**
```
tokyo_20250401_20250430.csv      # 東京 2025年4月1日～30日
osaka_202505.csv                 # 大阪 2025年5月全体
```

#### データフォーマット
- **エンコーディング**: Shift_JIS
- **ヘッダー**: 最初の4行はスキップされます
- **時間間隔**: 1時間間隔
- **含まれるデータ**: 気温、降水量、日照時間、風速、日射量など

### データの更新
新しいファイルを追加した場合は、アプリケーションを再起動するか、リロードボタンをクリックしてデータ可用性マップを更新してください。

## 💻 システム要件

### ハードウェア要件

#### JavaFX版（軽量）
| 項目 | 最小要件 | 推奨要件 |
|------|---------|---------|
| **CPU** | デュアルコア 2.0 GHz以上 | クアッドコア 2.5 GHz以上 |
| **メモリ** | 4 GB | 8 GB |
| **ストレージ** | 200 MB | 500 MB |
| **ディスプレイ** | 1280×720 | 1920×1080 |

#### Python版（基本機能）
| 項目 | 最小要件 | 推奨要件 |
|------|---------|---------|
| **CPU** | デュアルコア 2.5 GHz以上 | クアッドコア 3.0 GHz以上 |
| **メモリ** | 8 GB | 16 GB |
| **ストレージ** | 500 MB（依存パッケージ含む） | 1 GB |
| **ディスプレイ** | 1920×1080 | 1920×1080以上 |

#### Python版（AI/機械学習機能使用時）
| 項目 | 最小要件 | 推奨要件 |
|------|---------|---------|
| **CPU** | クアッドコア 3.0 GHz以上 | 6コア以上 3.5 GHz |
| **メモリ** | 8 GB（ARIMA/指数平滑法のみ） | 16 GB（Transformer使用時） |
| **GPU** | 不要（CPU動作可） | CUDA対応GPU（学習高速化） |
| **ストレージ** | 2 GB（PyTorch含む） | 3 GB |
| **ディスプレイ** | 1920×1080 | デュアルモニター推奨 |

**処理時間の目安:**
- **統計分析**: 即座（<1秒）
- **ARIMA/指数平滑法**: 数秒～10秒
- **Transformer学習**: 30～60秒（1,400サンプル、30エポック、CPU）
- **Transformer学習**: 5～10秒（GPU使用時）

### ソフトウェア要件

| ソフトウェア | 対応バージョン | 備考 |
|------------|--------------|------|
| **OS** | Windows 10/11, macOS 10.15+, Linux (Ubuntu 20.04+) | すべてのOSで動作確認済み |
| **Java（JavaFX版）** | JDK 17以降 | OpenJDK推奨 |
| **Python（Python版）** | 3.10, 3.11, 3.12 | 3.11推奨 |
| **ブラウザ** | Chrome, Firefox, Edge最新版 | データソースリンク表示用 |

## 🛠️ 技術スタック

### 主要ライブラリ・フレームワーク

#### JavaFX版
| ライブラリ | バージョン | 用途 |
|-----------|----------|------|
| **JDK** | 17以降 | Java実行環境 |
| **JavaFX** | 21.0.4 | GUIフレームワーク |
| **OpenCSV** | 5.9 | CSV読み込み |

**起動コマンド:**
```powershell
.\gradlew.bat run
```

#### Python版（必須）
| ライブラリ | バージョン | 用途 |
|-----------|----------|------|
| **Python** | 3.10-3.12 | プログラミング言語 |
| **PySide6** | 6.7.2 | GUIフレームワーク（Qt6ベース） |
| **pandas** | 2.2.3 | データ処理・分析 |
| **numpy** | 2.1.3 | 数値計算 |
| **matplotlib** | 3.9.2 | グラフ描画 |
| **scipy** | 1.14.1 | 科学計算 |
| **statsmodels** | 0.14.4 | 統計モデル・時系列分析 |
| **scikit-learn** | 1.5.2 | 機械学習（前処理・評価） |

#### Python版（オプション - AI機能用）
| ライブラリ | バージョン | 用途 |
|-----------|----------|------|
| **PyTorch** | 2.4.1 (CPU) | ディープラーニング（Transformer） |
| **PyTorch (GPU)** | 2.4.1 + CUDA 11.8+ | GPU加速学習 |

**起動コマンド:**
```powershell
python main.py
```

## ✨ 主な機能（Python版）

Python版は6つのタブで構成され、データ分析のあらゆるニーズに対応します。

### 📊 1. メインタブ - データ閲覧とグラフ表示
**できること:**
- エリア・年月の選択
- データの表形式プレビュー（列幅自動調整）
- インタラクティブなグラフ表示
  - ズーム・パン機能（マウス操作）
  - 複数系列の同時表示
  - 詳細な目盛り表示オプション
- グラフのスナップショット保存
- オーバーレイ表示（異なるデータの重ね合わせ）

**用途:** データの概要把握、トレンド確認、簡易的な比較

### � 2. 統計分析・予測タブ - 高度な分析とAI予測
**できること:**

#### 統計分析
- **記述統計**: 平均、中央値、標準偏差、歪度、尖度、変動係数
- **分布分析**: ヒストグラム、箱ひげ図、外れ値検出
- **相関分析**: 発電種別間の相関ヒートマップ
- **時間帯パターン**: 24時間の需要変動パターン

#### AI予測（4種類の手法）
1. **STL分解**: トレンド・季節性・残差の分離
2. **ARIMA予測**: 統計的時系列予測（自動パラメータ最適化）
3. **指数平滑法**: Holt-Winters法による短期予測
4. **Transformer予測**: ディープラーニングによる高精度予測（PyTorch必須）

#### モデル評価
- MAE（平均絶対誤差）
- RMSE（二乗平均平方根誤差）
- MAPE（平均絶対パーセント誤差）
- 残差分析（Q-Qプロット、ACF）

**用途:** 詳細なデータ分析、将来予測、モデル比較

### 🌤️ 3. 気象データ統合（v2.1）
**できること:**
- 気象庁データの読み込み・可視化
- 天候と電力需給の相関分析
  - 気温 vs 需要
  - 日射量 vs 太陽光発電
  - 風速 vs 風力発電
- ARIMAX予測（天候を説明変数として使用）

**対応気象要素:**
- 気温（℃）
- 降水量（mm）
- 日照時間（時間）
- 風速・風向（m/s）
- 日射量（MJ/m²）

**用途:** 天候の影響分析、再生可能エネルギーの予測精度向上

### 📅 4. データ可用性タブ - データ管理
**できること:**
- 全エリア・全期間のデータ可用性をヒートマップで可視化
- 欠損期間の一目確認
- データ収集状況の把握

**用途:** データセットの全体像把握、追加データの必要性確認

### 📊 5. 発電種別比較タブ - 詳細比較分析
**できること:**

#### 比較モード（3種類）
1. **エリア別比較**: 同じ年月の異なるエリアを比較
2. **月間推移比較**: 1年間の月別推移を分析
3. **年度間比較**: 複数年の同月を比較

#### 表示形式
- 積み上げ棒グラフ
- 円グラフ（合計値）
- 電力量（MWh）または割合（%）で表示

#### 比較可能な項目
- **需要**: エリア需要実績（30分間隔データの積算値）
- **原子力**: 原子力発電
- **火力**: LNG、石炭、石油、その他の合計
- **水力**: 水力発電
- **地熱**: 地熱発電
- **バイオマス**: バイオマス発電
- **太陽光**: 太陽光発電実績
- **風力**: 風力発電実績
- **揚水**: 揚水発電

**計算方法:**
```
月間電力量(MWh) = Σ(各30分のMW平均値 × 0.5時間)
```

**用途:** エリア間比較、発電ミックスの変化分析、再エネ比率の把握

### 🔢 6. 数値比較分析タブ - 定量的な差分計算
**できること:**
- 2つのデータセット（異なるエリア・年月）の定量比較
- 自動計算項目:
  - **データ1の値**: 第1データセットの電力量（MWh）
  - **データ2の値**: 第2データセットの電力量（MWh）
  - **差分**: データ2 - データ1（MWh）
  - **変化率**: (データ2 - データ1) / データ1 × 100（%）
  - **比率**: データ2 / データ1
- 結果のCSV出力（Excel/PowerPoint用）

**用途:** 
- 年度比較レポート作成
- エリア間の電力需給差分析
- プレゼンテーション資料作成の効率化

**例: 2025年4月と5月の北海道エリア需要比較**
| 項目 | データ1（4月） | データ2（5月） | 差分 | 変化率 |
|------|---------------|---------------|------|--------|
| 需要 | 2,295,002 MWh | 2,180,500 MWh | -114,502 MWh | -5.0% |

### 🎨 グラフ機能の詳細
すべてのグラフタブで以下の機能が利用可能:
- **ズーム**: マウスドラッグで拡大、右クリックで元に戻る
- **パン**: 拡大後にドラッグで移動
- **詳細目盛り**: 時間軸の細かい目盛り表示
- **オーバーレイ**: 複数データの重ね合わせ表示
  - 時系列モード: 同じ時間軸で比較
  - X軸共有モード: データポイント番号で比較
- **PNG保存**: 高解像度でグラフを画像保存

---

詳細な使い方は [FEATURES.md](FEATURES.md) をご覧ください。

## 🚀 クイックスタート

### Python版（推奨）- 5分で開始

#### 1. 環境準備

**Windows PowerShell:**
```powershell
# プロジェクトフォルダに移動
cd jukyu_app_python_desktop

# 仮想環境を作成（初回のみ）
python -m venv .venv

# 仮想環境を有効化
.\.venv\Scripts\activate

# 依存パッケージをインストール
pip install -r requirements.txt
```

**macOS / Linux:**
```bash
cd jukyu_app_python_desktop
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

#### 2. データ準備（オプション）
サンプルデータが `data/` フォルダに含まれています。
- 北海道エリア（01）: 2025年4月～9月
- その他エリア: 同様の期間

追加データを配置する場合:
```
data/
├── eria_jukyu_202510_03.csv  # 2025年10月 東京
├── eria_jukyu_202511_06.csv  # 2025年11月 関西
└── weather/
    ├── tokyo_202510.csv      # 東京の気象データ
    └── osaka_202511.csv      # 大阪の気象データ
```

#### 3. アプリ起動
```powershell
python main.py
```

起動すると、6つのタブを持つメインウィンドウが表示されます。

#### 4. 基本的な使い方

**データ閲覧（メインタブ）:**
1. エリアを選択（例: `(01) 北海道`）
2. 年を選択（例: `2025`）
3. 月を選択（例: `4`）
4. 「データ読み込み」ボタンをクリック
5. 表とグラフが表示されます

**統計分析:**
1. 「統計分析・予測」タブを開く
2. エリア・年月を選択
3. 「統計分析実行」ボタンをクリック
4. 各サブタブで結果を確認

**AI予測（ARIMA）:**
1. 「統計分析・予測」タブを開く
2. 「需要実績」など予測対象を選択
3. 予測期間を入力（例: 24時間）
4. 「ARIMA予測」ボタンをクリック
5. 予測結果、評価指標、残差分析が表示されます

**発電種別比較:**
1. 「発電種別比較」タブを開く
2. 比較モードを選択（エリア別/月間推移/年度間）
3. 対象エリア・年月を選択
4. 発電種別にチェック（需要、原子力、火力など）
5. 「集計・グラフ表示」ボタンをクリック

**数値比較分析:**
1. 「数値比較分析」タブを開く
2. データ1: エリア・年月を選択（例: 北海道 2025年4月）
3. データ2: エリア・年月を選択（例: 北海道 2025年5月）
4. 比較項目にチェック
5. 「比較を実行」ボタンをクリック
6. 差分・変化率が自動計算されます
7. 「結果をCSVで保存」でExcel用データを出力

#### 5. AI機能を使う（オプション）

Transformer予測を使用する場合、PyTorchをインストール:

**CPU版（推奨 - 初回）:**
```powershell
pip install torch==2.4.1 torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

**GPU版（CUDA対応GPU搭載の場合）:**
```powershell
# CUDA 11.8の場合
pip install torch==2.4.1 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# CUDA 12.1の場合
pip install torch==2.4.1 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

インストール後、「Transformer予測」ボタンが使用可能になります。

---

### JavaFX版 - シンプルな閲覧

#### 1. 起動
```powershell
cd jukyu_app_javafx
.\gradlew.bat run
```

Gradleが自動的にJavaFXをダウンロードします（初回のみ）。

#### 2. 使い方
1. ツールバーでエリアを選択
2. データ可用性ヒートマップで月をクリック
3. CSVプレビューとグラフが表示されます

#### 3. パッケージング（配布用）
```powershell
.\gradlew.bat jar
```

生成される `build/libs/` 内のJARファイルを配布できます。

## 📖 よくある質問（FAQ）

### Q1: データはどこから入手できますか？
**A:** 日本の電力広域的運営推進機関（OCCTO）のWebサイトから電力需給実績データをダウンロードできます。気象データは気象庁のWebサイトから時別値データを取得してください。

### Q2: グラフが表示されません
**A:** 以下を確認してください:
- データファイルが正しい命名規則に従っているか
- ファイルがShift_JISまたはUTF-8でエンコードされているか
- ファイルに必須列（DATE, TIME, エリア需要など）が含まれているか

### Q3: Transformer予測が使えません
**A:** PyTorchがインストールされているか確認してください:
```powershell
pip install torch==2.4.1 torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

### Q4: メモリ不足エラーが出ます
**A:** 以下を試してください:
- 他のアプリケーションを閉じる
- データ期間を短くする（1ヶ月単位で分析）
- Transformer予測の場合、バッチサイズを小さくする
- システムメモリを増設（16GB推奨）

### Q5: グラフの保存方法は？
**A:** 
- メインタブ: 「グラフスナップショット」機能で保存
- グラフツールバー: ディスクアイコンをクリックして保存
- 数値比較: 「結果をCSVで保存」でデータを出力後、Excelでグラフ作成

### Q6: 複数エリアを同時に表示できますか？
**A:** 
- **オーバーレイ表示**: メインタブで複数のグラフカードを作成し、オーバーレイチェックボックスを使用
- **発電種別比較タブ**: エリア別比較モードで複数エリアの棒グラフ比較が可能

### Q7: 予測精度を上げるには？
**A:** 
- より多くの履歴データを使用する
- 気象データを統合してARIMAX予測を使用する
- 複数モデルの結果を比較し、MAE/RMSEが低いモデルを選択する
- Transformer予測でエポック数を増やす（30→50）

### Q8: CSVエクスポートしたデータをPowerPointで使いたい
**A:** 
1. 「数値比較分析」タブで比較を実行
2. 「結果をCSVで保存」をクリック
3. Excelで開く
4. グラフを作成してPowerPointに貼り付け

---

## 🔧 開発者向け情報

### プロジェクト構造
- **JavaFX版**: Gradleプロジェクト、JavaFX 21.0.4使用
- **Python版**: Qtベースのデスクトップアプリ、PySide6使用

### 技術的特徴
- **マルチエンコーディング対応**: Shift_JIS、CP932、UTF-8を自動判別
- **キャッシング**: JavaFX版はディレクトリスキャン結果をキャッシュして高速化
- **レスポンシブUI**: 非同期処理により重い計算中もUIがフリーズしない
- **拡張性**: 新しい予測モデルや分析手法の追加が容易な設計

### コントリビューション方法
1. このリポジトリをフォーク
2. フィーチャーブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m '素晴らしい機能を追加'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

**コントリビューション時の注意:**
- コードに適切なコメントを記載
- 新機能は `FEATURES.md` に説明を追加
- UI変更の場合はスクリーンショットを添付

---

## 📝 変更履歴

詳細な開発履歴は [DEVELOPMENT_HISTORY.md](DEVELOPMENT_HISTORY.md) を参照してください。

### 最新版（v2.1）- 2025年11月
- ✅ 需要項目を発電種別比較・数値比較に追加
- ✅ 数値比較の比較項目欄をGridLayoutで3列表示に改善
- ✅ メインタブと結果テーブルの列幅を自動調整
- ✅ 電力量計算の修正（MW × 0.5h = MWh）
- ✅ 「エリア需要」列名をGENERATION_CATEGORIESに追加

### v2.0 - 2025年
- 気象データ統合機能
- ARIMAX予測（気象を説明変数として使用）
- 発電種別比較タブ追加
- 数値比較分析タブ追加
- グラフのズーム・パン機能
- オーバーレイ表示機能

### v1.0 - 2024年
- 基本的なデータ閲覧機能
- 統計分析機能（STL, ARIMA, 指数平滑法）
- Transformer予測機能
- JavaFX版とPython版の両方を実装

---

## 📚 参考資料

### 電力需給データ
- [電力広域的運営推進機関（OCCTO）](https://www.occto.or.jp/)
- 電力需給実績データのダウンロードページ

### 気象データ
- [気象庁 過去の気象データ](https://www.data.jma.go.jp/gmd/risk/obsdl/)
- 時別値データのダウンロード方法

### 技術文献
- Box, G. E. P., Jenkins, G. M., & Reinsel, G. C. (2015). *Time Series Analysis: Forecasting and Control.*
- Hyndman, R. J., & Athanasopoulos, G. (2021). *Forecasting: Principles and Practice (3rd ed.)*
- Vaswani, A., et al. (2017). *Attention Is All You Need.* (Transformer論文)

### フレームワーク・ライブラリ
- [PySide6 Documentation](https://doc.qt.io/qtforpython/)
- [Statsmodels Documentation](https://www.statsmodels.org/)
- [PyTorch Documentation](https://pytorch.org/docs/)

---

## 📧 サポート・お問い合わせ

- **Issue報告**: GitHubのIssuesページで報告してください
- **機能要望**: Issuesに `enhancement` ラベルを付けて投稿
- **質問**: Discussionsページをご利用ください

---

## ⚖️ ライセンス

このプロジェクトのライセンスは後日指定されます（MIT、Apache 2.0等を検討中）。

---

## 🙏 謝辞

このプロジェクトは以下のオープンソースプロジェクトを使用しています:
- Qt / PySide6
- pandas, numpy, scipy
- matplotlib
- statsmodels
- PyTorch
- scikit-learn

電力需給データは電力広域的運営推進機関（OCCTO）、気象データは気象庁より提供されています。
