# 電力需給分析ツール

日本の電力需給データ（CSV）を分析・可視化するデスクトップアプリケーションです。  
PySide6とMatplotlibを使用し、グラフ表示、統計分析、AI予測機能を提供します。

---

## 📋 主な機能

### 🏠 メインタブ
- **エリア選択**: 北海道から沖縄まで10電力エリアに対応
- **データ有無確認**: ヒートマップでデータの存在を視覚的に確認
- **年月選択**: 年と月を個別のプルダウンで選択

### 📊 詳細分析タブ
- **複数系列グラフ**: 需要、供給、発電種別など複数の列を同時にグラフ化
- **グラフ設定**: タイトル、軸ラベル、凡例、線幅、フォントサイズなど細かく調整可能
- **表示オプション**: タイトル・軸ラベル・凡例の表示/非表示を切り替え（プレゼン用）
- **画像保存**: グラフをPNG形式で保存

### ⚡ 発電種別比較タブ
- **エリア間比較**: 同一年月で複数エリアの発電構成を比較
- **月間推移比較**: 1年間の発電種別推移を確認
- **グラフ形式**: 積み上げ棒グラフ、円グラフを選択可能
- **発電種別**: 原子力、火力、水力、太陽光、風力など8種類
- **需給実績**: エリア需要、エリア供給、連系線、揚水動力も比較可能
- **数値データ**: テーブルで詳細数値を確認
- **コピー機能**: Excel/PowerPointに貼り付け可能な形式でコピー

### 🤖 AI分析タブ
- **統計集計**: 時間別/日別/週別/月別で合計・平均・最小・最大を計算（単位付き表示）
- **積算値対応**: 瞬時値だけでなく積算値（日別合計）での分析も可能
- **需要・天候分析**: 需要の高い/低い日の天候・曜日パターンを分析
- **Transformer予測**: 機械学習による電力需要予測
- **ARIMAX予測**: 気象データを考慮した統計予測（天気データが必要）
- **データエクスポート**: 分析結果をCSVで出力

---

## 💻 動作環境

- **Python**: 3.10〜3.12（3.11推奨）
  - ⚠️ Python 3.14は非対応（PySide6が未対応）
- **OS**: Windows 10/11, macOS, Linux

### 必要なライブラリ
```
PySide6==6.7.2
pandas==2.2.3
numpy==2.1.3
matplotlib==3.9.2
scikit-learn==1.5.2
torch==2.4.1
statsmodels==0.14.4
```

---

## 🚀 インストール方法

### 方法1: バッチファイルで起動（Windows・推奨）

1. `電力需給分析ツール.bat` をダブルクリック
2. 初回は自動で仮想環境が作成されます（数分かかります）
3. 2回目以降は自動で仮想環境を検知して起動します

### 方法2: 手動でセットアップ

```powershell
# フォルダに移動
cd jukyu_app_python_desktop

# 仮想環境を作成
python -m venv .venv

# 仮想環境を有効化（Windows）
.\.venv\Scripts\activate

# 必要なライブラリをインストール
pip install -r requirements.txt

# アプリを起動
python main.py
```

macOS/Linuxの場合:
```bash
source .venv/bin/activate
```

---

## 📁 データの配置

### CSVファイル
- `data/` フォルダに配置
- ファイル名形式: `eria_jukyu_YYYYMM_AA.csv`
  - `YYYYMM`: 年月（例: 202504）
  - `AA`: エリアコード（01〜10）
- 文字コード: Shift_JIS/CP932（UTF-8も対応）

### エリアコード一覧
| コード | エリア |
|--------|--------|
| 01 | 北海道 |
| 02 | 東北 |
| 03 | 東京 |
| 04 | 中部 |
| 05 | 北陸 |
| 06 | 関西 |
| 07 | 中国 |
| 08 | 四国 |
| 09 | 九州 |
| 10 | 沖縄 |

### 天気データ（任意）
- `data/weather/` フォルダに配置
- ARIMAX予測機能で使用

---

## 📖 使い方

### 基本的な流れ

1. **メインタブ** でエリアと年月を選択
2. **詳細分析タブ** で表示したい列を選択してグラフを描画
3. 必要に応じて **発電種別比較** でエリア間・月間の比較
4. **AI分析タブ** で統計集計や予測を実行

### 統計集計の使い方

1. メインタブで「📊 統計分析に移行」ボタンをクリック
2. AI分析タブの「統計集計」サブタブに移動
3. 対象列と集計期間を選択
4. 「集計実行」をクリック
5. 結果には単位（kW、kWhなど）が自動で付与されます
6. 「📋 クリップボードにコピー」でExcel/PowerPointに貼り付け可能

### グラフのカスタマイズ

- **表示オプション**: タイトル、X軸ラベル、Y軸ラベル、凡例の表示/非表示を切り替え
- **スタイル設定**: 線幅、フォントサイズ、図の大きさを調整
- **保存**: 「💾 グラフを保存」でPNG形式で保存

---

## 🔧 トラブルシューティング

### 「PySide6がインストールできない」
→ Python 3.14を使用している可能性があります。Python 3.11.xをインストールしてください。

### 「日本語が文字化けする」
→ MS Gothic、Yu Gothic、Meiryoなどの日本語フォントがインストールされているか確認してください。

### 「CSVが読み込めない」
→ ファイル名が `eria_jukyu_YYYYMM_AA.csv` の形式になっているか確認してください。

### 「グラフが遅い」
→ 選択する列数を減らすか、データをダウンサンプリングしてください。

---

## 📂 ファイル構成

```
jukyu_app_python_desktop/
├── main.py                    # メインアプリケーション
├── run.py                     # ランチャー（自動環境検知）
├── requirements.txt           # 依存ライブラリ一覧
├── 電力需給分析ツール.bat      # Windows用起動バッチ
├── README.md                  # このファイル
├── data/                      # 電力需給CSVデータ
│   └── weather/               # 天気データ（任意）
└── ml/                        # 機械学習モジュール
```

---

## 🔄 更新履歴

### 2025年12月
- 需要・天候分析機能（日別/時別）追加
- 積算値オプション追加（統計集計、需要・天候分析）
- 発電種別比較に需給実績（エリア需要、エリア供給等）選択を追加
- 天候データの天気コード対応（晴れ/曇/雨など）
- エンコーディング対応強化（CP932/UTF-8）

### 2024年12月
- グラフ表示オプション（タイトル・軸ラベル・凡例の表示切替）追加
- 統計集計機能（時間別/日別/週別/月別）追加 ※単位自動付与
- 発電種別比較に数値データタブとコピー機能追加
- メインタブから統計分析タブへのデータ移行機能追加
- 仮想環境自動検知ランチャー追加
- README日本語化
