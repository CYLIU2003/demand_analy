# ⚡ Grid Demand Insights - 機能詳細ガイド

このドキュメントでは、Python版アプリケーションの全機能を詳しく説明します。

## 📑 目次

1. [メインタブ - データ閲覧とグラフ表示](#1-メインタブ---データ閲覧とグラフ表示)
2. [統計分析・予測タブ - 高度な分析とAI予測](#2-統計分析予測タブ---高度な分析とai予測)
3. [データ可用性タブ](#3-データ可用性タブ)
4. [発電種別比較タブ](#4-発電種別比較タブ)
5. [数値比較分析タブ](#5-数値比較分析タブ)

---

## 1. メインタブ - データ閲覧とグラフ表示

### 概要
電力需給データの基本的な閲覧とグラフ表示を行います。直感的なUIで、データの概要把握やトレンド確認が可能です。

### 1.1 データ選択

#### エリア選択
- **対応エリア**: 10エリア（北海道～沖縄）
- **表示形式**: `(コード) エリア名`
  - 例: `(01) 北海道`、`(03) 東京`、`(06) 関西`
- **選択方法**: ドロップダウンメニュー

#### 年月選択
- **年選択**: 利用可能な年のみ表示
- **月選択**: 1～12月から選択
- **データがない場合**: グレーアウト表示

### 1.2 データプレビュー

#### 表形式表示
**特徴:**
- 全列を表形式で表示
- 列幅は内容に応じて自動調整（ResizeToContents機能）
- 行の交互色表示で可読性向上
- 縦横スクロール対応

**表示される主な列:**
| 列名 | 説明 | 単位 |
|------|------|------|
| DATE | 日付 | YYYY/MM/DD |
| TIME | 時刻（30分間隔） | HH:MM |
| エリア需要 | エリア全体の電力需要 | MW |
| 原子力 | 原子力発電出力 | MW |
| 火力(LNG) | LNG火力発電出力 | MW |
| 火力(石炭) | 石炭火力発電出力 | MW |
| 水力 | 水力発電出力 | MW |
| 太陽光発電実績 | 太陽光発電出力 | MW |
| 風力発電実績 | 風力発電出力 | MW |
| 揚水 | 揚水発電出力 | MW |

### 1.3 グラフ表示

#### 基本機能
- **グラフ種類**: 時系列折れ線グラフ
- **軸設定**:
  - X軸: 日時（30分刻み）
  - Y軸: 電力（MW）
- **凡例**: 自動的に色分けされた系列名
- **グリッド**: 主グリッド線を表示

#### インタラクティブ操作（ナビゲーションツールバー）

**ツールバー機能:**
| アイコン | 機能 | 操作方法 |
|---------|------|---------|
| 🏠 ホーム | 元の表示に戻る | クリック |
| ← 戻る | 1つ前の表示に戻る | クリック |
| → 進む | 1つ次の表示に進む | クリック |
| ↔ パン | グラフを移動 | ドラッグ |
| 🔍 ズーム | グラフを拡大 | 範囲をドラッグ |
| ⚙ 設定 | 余白調整 | ダイアログ表示 |
| 💾 保存 | PNG保存 | ファイル名指定 |

**ズーム操作:**
1. ズームアイコンをクリック
2. 拡大したい範囲をマウスでドラッグ
3. 元に戻すには「ホーム」をクリック

**パン操作:**
1. パンアイコンをクリック
2. グラフをドラッグして表示範囲を移動

#### 詳細設定
- **詳細な目盛り表示**: 時間軸の細かい目盛りとマイナーグリッドを表示
- **フォントサイズ**: ラベルと凡例のフォントサイズ調整
- **図のサイズ**: グラフの幅と高さを指定
- **DPI**: 画像解像度の設定（72～300）

### 1.4 グラフスナップショット機能

複数のグラフカードを作成し、異なるデータを同時に管理できます。

#### グラフカードとは
- 1つのデータセット + グラフ設定を保存した「カード」
- 最大数制限なし
- 各カードは独立して管理

#### 操作方法

**カードの作成:**
1. データを読み込む
2. グラフ設定を調整
3. 「グラフスナップショット」ボタンをクリック
4. 新しいカードが「グラフコレクション」タブに追加

**カードの表示内容:**
- エリア名と年月
- 小さなグラフプレビュー
- 選択した系列名
- オーバーレイチェックボックス
- 削除ボタン

**カードの削除:**
- カード右上の「削除」ボタンをクリック

### 1.5 オーバーレイ表示

複数のデータセットを1つのグラフに重ねて表示し、比較分析を行います。

#### オーバーレイモード

**1. 時系列モード（デフォルト）**
- **X軸**: 共通の日時軸
- **用途**: 同じ時期の異なるエリア・年を比較
- **例**:
  - 2025年4月の北海道と東京の需要比較
  - 2024年と2025年の同月比較

**2. X軸共有モード**
- **X軸**: データポイント番号（1, 2, 3, ...）
- **用途**: 異なる期間のパターン比較
- **例**:
  - 4月と8月の日内変動パターン比較
  - 平日と休日の需要パターン比較

#### 使い方

**手順:**
1. 比較したいデータで複数のグラフカードを作成
2. 「グラフコレクション」タブを開く
3. 重ねたいカードのオーバーレイチェックボックスをON
4. オーバーレイモードを選択（時系列 or X軸共有）
5. 「オーバーレイ表示」ボタンをクリック

**結果:**
- 選択したカードが1つのグラフに重ねて表示
- 各系列は異なる色で自動的に色分け
- 凡例に「エリア名 - 系列名」が表示

---

## 2. 統計分析・予測タブ - 高度な分析とAI予測

### 概要
電力需給データの詳細な統計分析と、AI/機械学習を使った予測を行います。

### 2.1 統計分析機能

#### 2.1.1 基本統計量レポート

データの数値的特徴を定量化します。

**記述統計:**
| 指標 | 説明 | 用途 |
|------|------|------|
| サンプル数 | データポイントの総数 | データの規模確認 |
| 平均値 | データの中心傾向 | 典型的な値を把握 |
| 中央値 | データの中央の値 | 外れ値の影響を排除 |
| 標準偏差 | データのばらつき | 変動の大きさを評価 |
| 最小値 | データの最小値 | 最低需要の把握 |
| 最大値 | データの最大値 | ピーク需要の把握 |

**分布特性:**
| 指標 | 説明 | 解釈 |
|------|------|------|
| 歪度（Skewness） | 分布の非対称性 | 正: 右裾が長い、負: 左裾が長い、0: 対称 |
| 尖度（Kurtosis） | 分布の尖り具合 | 高: 極端な値が多い、低: 平坦な分布 |
| 変動係数（CV） | 相対的なばらつき | (標準偏差/平均) × 100% |

**活用例:**
```
【例: 2025年4月 北海道エリア需要】
サンプル数: 1,440
平均値: 3,187.5 MW
中央値: 3,150.0 MW
標準偏差: 350.2 MW
変動係数: 11.0%

→ 解釈: 需要は平均3,200MW前後で、±350MW程度の変動がある
```

#### 2.1.2 時系列トレンド分析

**表示内容:**
- 需要実績と各発電種別の時系列グラフ
- 長期トレンドの可視化
- 複数系列の同時表示

**用途:**
- 需要の増減トレンドを確認
- 発電種別の構成変化を把握
- 異常値や欠損値を発見
- 再生可能エネルギーの導入推移を分析

#### 2.1.3 分布特性分析

**ヒストグラム:**
- **表示内容**: データの頻度分布
- **追加要素**:
  - 平均値（赤色の縦線）
  - 中央値（緑色の縦線）
- **ビン数**: 自動最適化（Sturgesの公式）

**用途:**
- データの分布形状を視覚的に把握
- 正規分布からの乖離を確認
- 多峰性（ピークが複数）の検出

**箱ひげ図（Box Plot）:**
- **箱**: 25%分位点～75%分位点（四分位範囲 IQR）
- **箱内の線**: 中央値
- **ひげ**: 最小値・最大値（1.5×IQR以内）
- **点**: 外れ値（1.5×IQR以上離れた点）

**用途:**
- データの中心と散らばりを一目で把握
- 外れ値の検出
- 複数データセットの分布比較

#### 2.1.4 相関分析

発電種別間の関係性を定量化し、ヒートマップで可視化します。

**相関係数の解釈:**
| 範囲 | 相関の強さ | 例 |
|------|----------|-----|
| +0.8 ～ +1.0 | 強い正の相関 | 需要と火力発電 |
| +0.5 ～ +0.8 | 中程度の正の相関 | 気温と需要（夏季） |
| -0.5 ～ +0.5 | 弱い相関 | 風力と需要 |
| -0.8 ～ -0.5 | 中程度の負の相関 | 太陽光と火力 |
| -1.0 ～ -0.8 | 強い負の相関 | （稀） |

**ヒートマップ表示:**
- **色**: 赤（正の相関）～ 青（負の相関）
- **数値**: 各セルに相関係数を表示
- **対角線**: 常に1.0（自分自身との相関）

**活用例:**
```
太陽光と火力の相関: -0.65
→ 解釈: 太陽光発電が増えると火力発電が減る（調整電源）

需要と原子力の相関: 0.12
→ 解釈: ほぼ無相関（ベースロード運転のため）
```

#### 2.1.5 時間帯別需要パターン分析

**表示内容:**
- X軸: 時刻（0時～23時）
- Y軸: 平均需要（MW）
- エラーバー: 標準偏差（ばらつきの範囲）

**用途:**
- 1日の需要変動パターンを把握
- ピーク時間帯（最大需要）の特定
- オフピーク時間帯（最小需要）の特定
- 曜日や季節による違いの分析

**典型的なパターン:**
```
【平日の需要パターン】
00:00～06:00: 低需要（2,500～3,000 MW）
08:00～10:00: 朝のピーク（3,500～4,000 MW）
13:00～14:00: 昼のピーク（3,800～4,200 MW）
17:00～19:00: 夕方のピーク（最大 4,500 MW）
21:00～: 徐々に減少
```

### 2.2 AI予測機能

時系列データの将来予測を4種類の手法で実行できます。

#### 2.2.1 STL時系列分解

**概要:**
Seasonal-Trend decomposition using Loess（STL）により、時系列データを3つの成分に分解します。

**分解成分:**
1. **トレンド成分**: 長期的な増減傾向
   - 平滑化された長期トレンド
   - 季節変動を除いた純粋な傾向

2. **季節性成分**: 周期的なパターン
   - 24時間周期（日内変動）
   - 1週間周期（曜日変動）

3. **残差成分**: ランダムな変動
   - トレンドと季節性では説明できない変動
   - ノイズや不規則な変化

**表示:**
- 4つのサブプロット
  - 元データ
  - トレンド
  - 季節性
  - 残差

**用途:**
- データ構造の理解
- 季節調整（季節性を除去したデータ）
- 異常値の検出（残差の大きな点）
- 予測モデルの前処理

**統計量:**
- 各成分の平均、標準偏差、最小値、最大値を表示

#### 2.2.2 ARIMA予測

**概要:**
AutoRegressive Integrated Moving Average（自己回帰和分移動平均）モデルによる統計的時系列予測。

**モデル:**
- ARIMA(5, 1, 0): 
  - AR(5): 過去5期の値を使用
  - I(1): 1階差分（トレンド除去）
  - MA(0): 移動平均なし

**特徴:**
- 統計的に根拠のある予測
- 信頼区間の計算が可能
- 短期～中期予測に適している
- パラメータ推定が自動化

**設定項目:**
| 項目 | 説明 | デフォルト値 | 推奨範囲 |
|------|------|------------|---------|
| 予測期間 | 予測するステップ数 | 24 | 6～96 |
| 訓練データ比率 | 学習に使用するデータの割合 | 80% | 70～90% |

**結果表示:**
1. **予測グラフ**: 
   - 青線: 実測値（テストデータ）
   - 赤線: 予測値
   - 時系列で重ねて表示

2. **モデル評価**:
   - MAE（平均絶対誤差）: 予測誤差の平均
   - RMSE（二乗平均平方根誤差）: 大きな誤差を重視
   - MAPE（平均絶対パーセント誤差）: 相対誤差（%）

3. **残差分析**:
   - 時系列プロット: 残差の時間変化
   - ヒストグラム: 残差の分布（正規分布に近いほど良い）
   - Q-Qプロット: 正規性の検定
   - ACF（自己相関関数）: 残差の独立性検証

**活用例:**
```
【設定】
予測期間: 24ステップ（12時間）
訓練データ: 80%（約1,150サンプル）
テストデータ: 20%（約290サンプル）

【結果】
MAE: 125.3 MW
RMSE: 178.6 MW
MAPE: 3.8%

→ 解釈: 平均して±125MW程度の誤差で予測可能
```

#### 2.2.3 指数平滑法（Holt-Winters）

**概要:**
Holt-Wintersの加法モデルによる時系列予測。トレンドと季節性を考慮した平滑化手法。

**モデルの特徴:**
- **加法モデル**: 季節変動の振幅が一定
- **トレンドあり**: 長期的な増減を考慮
- **季節性あり**: 24時間周期を自動検出

**平滑化パラメータ:**
| パラメータ | 説明 | 最適化 |
|-----------|------|--------|
| α (Alpha) | レベル平滑化係数 | 自動 |
| β (Beta) | トレンド平滑化係数 | 自動 |
| γ (Gamma) | 季節性平滑化係数 | 自動 |

**特徴:**
- 実装が簡単
- 計算が高速
- 直感的な理解が容易
- 短期予測に適している

**設定項目:**
- 予測期間
- 訓練データ比率

**結果表示:**
- ARIMAと同様（予測グラフ、評価指標、残差分析）

**活用例:**
```
【設定】
季節周期: 48（24時間 × 2コマ/時間）
予測期間: 48ステップ（24時間）

【結果】
MAE: 132.7 MW
RMSE: 185.2 MW
MAPE: 4.1%

→ 解釈: ARIMAと同程度の精度、計算時間は半分以下
```

#### 2.2.4 Transformer予測

**概要:**
注意機構（Attention Mechanism）を使ったディープラーニング予測モデル。

**必要環境:**
- PyTorch 2.4.1以降
- CPU: 8GB以上のRAM
- GPU（オプション）: CUDA対応GPU

**モデル構造:**
```
入力: 過去48時間のデータ（context_length=48）
↓
Transformer Encoder（注意機構）
↓
線形層
↓
出力: 未来24時間の予測（prediction_length=24）
```

**ハイパーパラメータ:**
| パラメータ | 説明 | デフォルト値 | 調整可能範囲 |
|-----------|------|------------|-------------|
| context_length | 入力時系列長 | 48 | 24～96 |
| prediction_length | 予測時系列長 | 24 | 6～48 |
| d_model | モデルの次元数 | 64 | 32～128 |
| nhead | 注意ヘッド数 | 4 | 2～8 |
| num_layers | Encoderレイヤー数 | 2 | 1～4 |
| epochs | 学習エポック数 | 30 | 10～100 |

**学習過程:**
1. データの前処理（正規化）
2. 訓練/検証データ分割
3. ミニバッチ学習
4. 損失関数: MSE（平均二乗誤差）
5. 最適化手法: Adam

**処理時間:**
- CPU（8コア）: 約30～60秒
- GPU（CUDA）: 約5～10秒

**結果表示:**
- 予測グラフ
- 評価指標（MAE, RMSE, MAPE）
- 学習曲線（エポックごとの損失）

**特徴:**
- 長期的な依存関係を捉えられる
- 非線形なパターンに対応
- 大量のデータで精度向上
- 複数系列の同時予測が可能

**活用例:**
```
【設定】
入力: 過去48時間（2日分）
出力: 未来24時間（1日分）
エポック数: 30

【結果】
MAE: 98.5 MW
RMSE: 142.3 MW
MAPE: 3.1%

→ 解釈: 統計手法より約20～25%精度向上
```

### 2.3 気象データ統合

天候情報と電力需給の関係を分析します。

#### 2.3.1 気象データ読み込み

**対応フォーマット:**
- 気象庁の時別値CSV（Shift_JIS）
- 最初の4行はヘッダー（自動スキップ）

**対応気象要素:**
| 要素 | 単位 | 用途 |
|------|------|------|
| 気温 | ℃ | 冷暖房需要との相関 |
| 降水量 | mm | 水力発電への影響 |
| 日照時間 | 時間 | 太陽光発電との相関 |
| 風速 | m/s | 風力発電との相関 |
| 日射量 | MJ/m² | 太陽光発電の精密分析 |

#### 2.3.2 相関分析

**散布図表示:**
- X軸: 気象要素（気温、日射量など）
- Y軸: 電力（需要、太陽光発電など）
- 各点: 1時間のデータ
- 回帰直線: 線形近似
- 相関係数: R値を表示

**活用例:**
```
【気温 vs 需要】
夏季: R = +0.85（強い正の相関）
→ 気温上昇 → 冷房需要増加

冬季: R = -0.72（中程度の負の相関）
→ 気温低下 → 暖房需要増加

【日射量 vs 太陽光発電】
R = +0.95（極めて強い正の相関）
→ 日射量から太陽光発電を高精度予測可能
```

#### 2.3.3 ARIMAX予測

**概要:**
ARIMAに外生変数（気象データ）を追加したモデル。

**モデル:**
```
y(t) = ARIMA部分 + β₁×気温(t) + β₂×日射量(t) + ...
```

**設定:**
- 説明変数: 気温、日射量、風速などを選択
- ARIMAパラメータ: (5, 1, 0)
- 予測期間: 24ステップ

**利点:**
- 天候の影響を明示的に組み込める
- 予測精度が向上（特に再エネ）
- 天候シナリオ別の予測が可能

**結果:**
- 通常のARIMAより5～15%精度向上

---

## 3. データ可用性タブ

### 概要
全エリア・全期間のデータ有無を一目で確認できるヒートマップです。

### 表示内容
- **行**: エリア（01～10）
- **列**: 年月（例: 2025-04）
- **色**:
  - 緑: データあり
  - グレー: データなし

### 用途
- データ収集状況の確認
- 欠損期間の特定
- 分析可能な期間の把握
- 追加データの必要性判断

---

## 4. 発電種別比較タブ

### 概要
複数のエリア・時期・発電種別を比較分析します。電力量（MWh）での定量比較が可能です。

### 4.1 比較モード

#### モード1: エリア別比較
**用途**: 同じ年月の複数エリアを比較

**設定項目:**
- 対象年月: 1つ選択
- 対象エリア: 複数選択（チェックボックス）

**例:**
```
2025年4月の全エリア需要比較
→ 東京エリアが最大、沖縄エリアが最小
```

#### モード2: 月間推移比較
**用途**: 1年間の月別推移を分析

**設定項目:**
- エリア: 1つ選択
- 対象年: 1つ選択

**例:**
```
2025年の北海道エリア月別需要推移
→ 1～2月が最大（暖房需要）、5～6月が最小
```

#### モード3: 年度間比較
**用途**: 複数年の同月を比較

**設定項目:**
- エリア: 1つ選択
- 対象月: 1つ選択（1～12月）

**例:**
```
北海道エリアの4月を年度間比較
2024年4月: 2,180,000 MWh
2025年4月: 2,295,002 MWh
→ 5.3%増加
```

### 4.2 表示形式

#### 電力量（MWh）モード
**計算方法:**
```
月間電力量(MWh) = Σ(各30分のMW平均値 × 0.5時間)
```

**例:**
```
エリア需要: 4,590,004 MW（合計）
データ件数: 1,440件（30分間隔）
月間電力量 = 4,590,004 × 0.5 = 2,295,002 MWh
```

#### 割合（%）モード
各発電種別の構成比を表示。

**計算方法:**
```
割合(%) = (該当種別のMWh / 総発電量のMWh) × 100
```

### 4.3 グラフ種類

#### 積み上げ棒グラフ
- 各エリア/時期の発電構成を棒グラフで表示
- 下から積み上げて合計を視覚化
- 色: 発電種別ごとに固定色

#### 円グラフ（合計値）
- 全エリア/期間の合計を円グラフで表示
- 各発電種別の割合を視覚化
- パーセンテージを自動表示

### 4.4 比較可能な項目

| カテゴリ | 説明 | 含まれる列名 |
|----------|------|------------|
| **需要** | エリア需要実績 | エリア需要、需要実績、需要 |
| **原子力** | 原子力発電 | 原子力 |
| **火力** | 火力発電合計 | 火力(LNG)、火力(石炭)、火力(石油)、火力(その他) |
| **水力** | 水力発電 | 水力 |
| **地熱** | 地熱発電 | 地熱 |
| **バイオマス** | バイオマス発電 | バイオマス |
| **太陽光** | 太陽光発電 | 太陽光発電実績、太陽光 |
| **風力** | 風力発電 | 風力発電実績、風力 |
| **揚水** | 揚水発電 | 揚水 |

**注意:** 30分間隔のMW平均値から、月間の電力量（MWh）を自動計算します。

---

## 5. 数値比較分析タブ

### 概要
2つのデータセット（異なるエリア・年月）の定量比較を自動計算します。PowerPoint資料作成に最適な機能です。

### 5.1 データ選択

#### データ1とデータ2
それぞれ独立して選択:
- エリア: 10エリアから選択
- 年: 利用可能な年から選択
- 月: 1～12月から選択

**選択例:**
```
データ1: (01) 北海道 2025年4月
データ2: (01) 北海道 2025年5月
→ 北海道の月別変化を分析
```

```
データ1: (01) 北海道 2025年4月
データ2: (03) 東京 2025年4月
→ エリア間の違いを分析
```

### 5.2 比較項目

発電種別比較と同じ9カテゴリから選択:
- 需要
- 原子力
- 火力
- 水力
- 地熱
- バイオマス
- 太陽光
- 風力
- 揚水

**表示形式:** 3列のGridLayoutで見やすく配置

### 5.3 自動計算項目

比較を実行すると、以下の6列の表が自動生成されます:

| 列名 | 説明 | 計算式 |
|------|------|--------|
| **項目** | 比較カテゴリ名 | - |
| **データ1の値 (MWh)** | 第1データセットの月間電力量 | Σ(MW × 0.5h) |
| **データ2の値 (MWh)** | 第2データセットの月間電力量 | Σ(MW × 0.5h) |
| **差分 (MWh)** | 絶対的な差 | データ2 - データ1 |
| **変化率 (%)** | 相対的な変化 | (データ2 - データ1) / データ1 × 100 |
| **比率** | データ2のデータ1に対する倍率 | データ2 / データ1 |

### 5.4 結果の見方

**例: 北海道エリア 2025年4月 vs 5月**

| 項目 | データ1 (4月) | データ2 (5月) | 差分 | 変化率 | 比率 |
|------|--------------|--------------|------|--------|------|
| 需要 | 2,295,002 | 2,180,500 | -114,502 | -5.0% | 0.95 |
| 火力 | 1,250,000 | 1,180,000 | -70,000 | -5.6% | 0.94 |
| 太陽光 | 85,000 | 120,000 | +35,000 | +41.2% | 1.41 |
| 風力 | 95,000 | 88,000 | -7,000 | -7.4% | 0.93 |

**解釈:**
- 需要は5月に5%減少（春の気候改善）
- 太陽光は41%増加（日照時間の増加）
- 火力は需要減少と太陽光増加で5.6%減少

### 5.5 CSV出力

**出力ボタン:** 「💾 結果をCSVで保存」

**ファイル形式:**
- エンコーディング: UTF-8 BOM付き（Excelで正しく開ける）
- 区切り文字: カンマ
- ヘッダー行あり

**活用方法:**
1. CSVで保存
2. Excelで開く
3. グラフを作成（棒グラフ、折れ線グラフなど）
4. PowerPointに貼り付け

**ファイル名例:**
```
comparison_20251126_142530.csv
```

### 5.6 合計行

テーブルの最下行に合計が自動計算されます:
- **項目名**: 「合計」（太字・背景色付き）
- **データ1の値**: 全項目の合計
- **データ2の値**: 全項目の合計
- **差分**: 合計の差分
- **変化率**: 合計の変化率
- **比率**: 合計の比率

---

## 📚 よくある質問

### Q1: どの予測手法を使えばいいですか？
**A:** 用途によります:
- **STL分解**: データの構造理解、前処理
- **ARIMA**: 統計的根拠が必要な場合、短期予測
- **指数平滑法**: 高速に結果が欲しい場合、直感的な理解
- **Transformer**: 最高精度が必要な場合、長期予測

### Q2: 予測精度を上げるには？
**A:**
- より多くの履歴データを使用する
- 気象データを統合してARIMAX予測を使う
- Transformerのエポック数を増やす（30→50）
- 複数モデルの結果を平均化（アンサンブル）

### Q3: グラフが見づらいです
**A:**
- 詳細な目盛り表示をONにする
- 図のサイズを大きくする（幅: 16、高さ: 10）
- DPIを上げる（100→150）
- フォントサイズを大きくする

### Q4: データが0になっています
**A:**
- CSV内の列名が正しいか確認してください
- 「エリア需要」「需要実績」「需要」などの列名に対応しています
- 発電種別も同様に、GENERATION_CATEGORIESに定義された列名と一致する必要があります

### Q5: 電力量（MWh）の計算方法は？
**A:**
```
月間電力量 = Σ(各30分のMW平均値 × 0.5時間)

例: 1,440件（30日間）のデータ
各時点: 3,187.5 MW平均
合計: 4,590,004 MW
電力量: 4,590,004 × 0.5 = 2,295,002 MWh
```

---

## 🎓 技術的な詳細

### データ処理パイプライン

```
1. CSV読み込み
   ↓
2. エンコーディング自動判別（Shift_JIS, CP932, UTF-8）
   ↓
3. ヘッダー行の自動検出とスキップ
   ↓
4. 日時列の統合（DATE + TIME → datetime）
   ↓
5. 数値列の型変換（str → float）
   ↓
6. カテゴリ集計（GENERATION_CATEGORIESに基づく）
   ↓
7. 電力量計算（MW × 0.5h = MWh）
   ↓
8. 可視化・分析
```

### 時系列予測の精度指標

**MAE（Mean Absolute Error）:**
```
MAE = (1/n) Σ|実測値 - 予測値|
```
- 単位: MW
- 意味: 予測誤差の平均的な大きさ
- 小さいほど良い

**RMSE（Root Mean Square Error）:**
```
RMSE = √[(1/n) Σ(実測値 - 予測値)²]
```
- 単位: MW
- 意味: 大きな誤差をより重視した指標
- 小さいほど良い

**MAPE（Mean Absolute Percentage Error）:**
```
MAPE = (100/n) Σ|実測値 - 予測値| / 実測値
```
- 単位: %
- 意味: 相対誤差（実測値に対する割合）
- 小さいほど良い
- 一般的に5%以下なら優秀、10%以下なら良好

### Transformerモデルのアーキテクチャ

```
Input Sequence (48 time steps)
    ↓
Positional Encoding
    ↓
Transformer Encoder × 2 layers
  ├─ Multi-Head Attention (4 heads)
  ├─ Add & Norm
  ├─ Feed Forward Network
  └─ Add & Norm
    ↓
Linear Projection
    ↓
Output Sequence (24 time steps)
```

**パラメータ数:**
- d_model=64, nhead=4, num_layers=2: 約50,000パラメータ
- 学習可能

### データ前処理

**正規化:**
```python
normalized = (data - mean) / std
```
- 平均0、標準偏差1に変換
- 学習の安定化と高速化

**逆正規化:**
```python
original = normalized * std + mean
```
- 予測値を元のスケールに戻す

---

## 📖 参考文献

### 時系列分析
- Box, G. E. P., Jenkins, G. M., & Reinsel, G. C. (2015). *Time Series Analysis: Forecasting and Control (5th ed.)*. Wiley.
- Hyndman, R. J., & Athanasopoulos, G. (2021). *Forecasting: Principles and Practice (3rd ed.)*. OTexts.
- Cleveland, R. B., et al. (1990). *STL: A Seasonal-Trend Decomposition Procedure Based on Loess*. Journal of Official Statistics.

### 機械学習
- Vaswani, A., et al. (2017). *Attention Is All You Need*. NIPS.
- Goodfellow, I., Bengio, Y., & Courville, A. (2016). *Deep Learning*. MIT Press.

### 電力システム
- 電力広域的運営推進機関（OCCTO）公開資料
- 各電力会社の供給計画書

---

## 🔄 バージョン履歴

### v2.1 (2025年11月)
- ✅ 需要項目を発電種別比較・数値比較に追加
- ✅ 比較項目欄をGridLayout（3列）に改善
- ✅ テーブル列幅の自動調整機能
- ✅ 電力量計算の修正（MW × 0.5h）
- ✅ 「エリア需要」列名の対応

### v2.0 (2025年)
- 気象データ統合機能
- ARIMAX予測
- 発電種別比較タブ
- 数値比較分析タブ
- グラフのズーム・パン機能
- オーバーレイ表示機能

### v1.0 (2024年)
- 基本的なデータ閲覧機能
- 統計分析機能
- ARIMA予測
- 指数平滑法予測
- Transformer予測
- STL分解

---

このドキュメントは、アプリケーションの全機能を網羅しています。不明な点があれば、GitHubのIssuesページでお問い合わせください。
